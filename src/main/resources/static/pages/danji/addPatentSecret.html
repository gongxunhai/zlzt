<head xmlns="http://www.w3.org/1999/html">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>专利导入</title>

    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./myfont/iconfont.css">
	<link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="./css/animate.css">
    <!-- <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script> -->
    <script src="./js/jquery.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
    <style>
         .main {
            width: 100%;
            min-height: 100vh;
            background-color: #ffffff;
            flex-direction: column;
        }

        .main .top {
            width: 100%;
            height: 380px;
            background-color: #087EDB;
			display: flex;
			flex-direction: column;
            /*justify-content: center;/*控制内容位于横轴的中间*/
            /*align-items: center;  /*控制内容位于纵轴的中间*/
        } 
		

        .top .top-content {
			width: 100%;
			height:60px;
			justify-content: center;/*控制内容位于横轴的中间*/
			margin-top: 90px;
            /* align-items: center; */
        }
		.top .top-discribe {
			width: 100%;
			height:60px;
			justify-content: center;/*控制内容位于横轴的中间*/
			 margin-top: 110px; 
			/* align-items: center; */
			
		}

        .top-content span {
			font-size: 36px;
			font-family:MicrosoftYaHei;
			font-weight:400;
			color:rgba(255,255,255,1);
			line-height:60px;
        }

        .top-content img {
            width: 60px;
            height: 57px;
            margin-left: 25px;
        }
		.top-discribe img {
		    width:60px;
			height:56px;
		    margin-left: 2%;
		}
		.top-discribe p{
			width:11%;
			height:25px;
			font-size:24px;
			font-family:MicrosoftYaHei;
			font-weight:400;
			color:rgba(254,254,254,1);
			line-height:60px;
		}
		.main .bottom {
		    width: 100%;
		    height: 2016px;
			background:rgba(255,255,255,1);
			box-shadow:0px 3px 10px 0px rgba(0, 0, 0, 0.08);
			border-radius:6px; 
			display: flex;
			flex-direction: column;
		    /*justify-content: center;/*控制内容位于横轴的中间*/
		    /*align-items: center;  /*控制内容位于纵轴的中间*/
		} 

		.bottom .bottom-content{
			float:left;
			width:50%;
			height:60px;
			margin-top: 30px;
			
		}
		.bottom .bottom-content1{
			float:left;
			width:50%;
			height:60px;
			margin-top: 30px;
			
		}
		.bottom-content span{
			width:40%;
			height:17px;
			font-size:18px;
			font-family:PingFangSC-Regular;
			font-weight:400;
			color:rgba(51,51,51,1);
			line-height:48px;
			text-align: right;
			margin-right: 20px;
			
		}
		.bottom-content1 span{
			width:24%;
			height:17px;
			font-size:18px;
			font-family:PingFangSC-Regular;
			font-weight:400;
			color:rgba(51,51,51,1);
			line-height:48px;
			text-align: right;
			margin-right: 20px;
			
		}
		.bottom input{
			width:42%;
			height:60px;
			background:rgba(245,246,250,1);
		}
		.bottom .bottom-content2{
			width:100%;
			height:120px;
			/* margin-left: 150px; */
			padding-top: 30px;
			/* margin-top:30px; */
			
		}
		.bottom-content2 textarea{
			width:63%;
			height:120px;
			background:rgba(245,246,250,1);
		}
		.bottom-content2 span{
			width:20%;
			height:17px;
			font-size:18px;
			font-family:PingFangSC-Regular;
			font-weight:400;
			color:rgba(51,51,51,1);
			line-height:48px;
			text-align: right;
			margin-right: 20px;
		}
		.bottom .bottom-content3{
			width:100%;
			height:60px;
			/* margin-left: 150px; */
			padding-top: 30px;
			margin-top:90px;
			
		}
		.bottom-content3 span{
			width:20%;
			height:17px;
			font-size:18px;
			font-family:PingFangSC-Regular;
			font-weight:400;
			color:rgba(51,51,51,1);
			line-height:48px;
			text-align: right;
			margin-right: 20px;
			
			margin-top:70px;
		}
		.bottom .bottom-submit{
			width:100%;
			height:100px;
			margin-top:120px;
			display: flex;
			flex-direction: column;
			justify-content: center;/*控制内容位于横轴的中间*/ 
			
		}
		
		
		.bottom-content3 .patentEgImg{
			width:160px;
			height:160px;
			/* margin-left: 18px; */
			margin-right: 18px;
		}
		.bottom-content3 .patentAddImg{
			width:50px;
			height:50px;
			margin-left: 30px;
			margin-top:55px;
		}
		
		.bottom-submit button{
			width:200px;
			height:80px;
			background:rgba(8,126,219,1);
			margin-left: 45%;
		}
		.bottom-submit span{
			width:43px;
			height:24px;
			font-size:24px;
			font-family:PingFangSC-Regular;
			font-weight:400;
			color:rgba(255,255,255,1);
			line-height:48px;
			
		}
         .fileinput-button {
             width:50px !important;
             height:50px !important;
             margin-left: 30px;
             margin-top:55px;
             background-image: url(imgs/add.png) !important;
             background-repeat: no-repeat !important;
             position: relative;
             border-radius: 30px;
             border: none;
         }
         .fileinput-button input{
             width:50px;
             position:absolute;
             right: 0px;
             top: 0px;
             opacity: 0;
             -ms-filter: 'alpha(opacity=0)';
         }
    </style>

</head>

<body>
    <div class="main">
		<div class="top  wow fadeInDown">
			<div class="top-content">
				<span>高分专项知识产权信息管理平台</span>
				<img src="./imgs/logo.png" alt="">
			</div>
			<div class="top-discribe">
				<img src="./imgs/result_white.png" alt="">
				<p>科技成果：<b id='kjResult'>30</b>项</p>
				<img src="./imgs/putong_white.png" alt="">
				<p>普通专利：<b id='putongZl'>30</b>项</p>
				<img src="./imgs/guofang_white.png" alt="">
				<p>国防专利：<b id='guofangZl'>30</b>项</p>
			</div>
		</div>

		<script src="js/htmlJs/publicHeader.js"></script>
        <div class="bottom wow fadeInUp">
            <form id="add_form"  onsubmit="return false">
                <div class="bottom-content">
                    <span>所属专题:</span>
                    <select id="fId" onchange="selectSid()" style="width: 42%;height: 60px"  type="text"></select>
                </div>
				<div class="bottom-content1">
					<span>二级专题:</span>
                    <select id="sId"  style="width: 42%;height: 60px" type="text"></select>
				</div>
                <div class="bottom-content">
                	<span>一级分类:</span>
                	<input id="tIdName" name="tIdName"  type="text"/>
                </div>
				<div class="bottom-content1">
					<span>二级分类:</span>
					<input id="cIdName" name="cIdName" type="text"/>
				</div>
				<div class="bottom-content">
					<span>国家:</span>
					<input id="country" name="country" type="text"/>
				</div>
				<div class="bottom-content1">
					<span>公开号:</span>
					<input id="openId" name="openId" type="text"/>
				</div>
                <div class="bottom-content">
					<span>公开日:</span>
					<input id="openDay" name="openDay" type="text"/>
				</div>
                <div class="bottom-content1">
                    <span>申请号:</span>
                    <input id="applyId" name="applyId" type="text"/>
                </div>
                <div class="bottom-content">
                    <span>申请日:</span>
                    <input id="applyDay" name="applyDay" type="text"/>
                </div>
                <div class="bottom-content1">
                    <span>标题:</span>
                    <input id="title" name="title" type="text"/>
                </div>
				<div class="bottom-content">
					<span>标题翻译:</span>
					<input id="titleFy" name="titleFy" type="text"/>
				</div>
                <div class="bottom-content2">
                    <span>摘要:</span>
                    <textarea id="zy" name="zy" type="text"></textarea>
                </div>
				<div class="bottom-content2">
					<span>摘要翻译:</span>
                    <textarea id="zyFy" name="zyFy" type="text"></textarea>
				</div>
				<div class="bottom-content">
					<span>权利要求数:</span>
					<input id="powerAN" name="powerAN" type="text"/>
				</div>
				<div class="bottom-content2">
					<span>权利要求:</span>
					<textarea id="powerAsk" name="powerAsk"></textarea>
				</div>
				<div class="bottom-content2">
					<span>权利要求翻译:</span>
					<textarea id="powerAFy" name="powerAFy"></textarea>
				</div>
				<div class="bottom-content">
				    <span>申请人:</span>
				    <input id="applyMan" name="applyMan" type="text"/>
				</div>
				<div class="bottom-content1">
					<span>申请地址:</span>
					<input id="applyPlace" name="applyPlace" type="text"/>
				</div>
				<div class="bottom-content">
					<span>发明人:</span>
					<input id="createMan" name="createMan" type="text"/>
				</div>
				<div class="bottom-content2">
					<span>法律状态:</span>
                    <textarea id="lawS" name="lawS" type="text"></textarea>
				</div>
                <div class="bottom-content">
					<span>当前法律状态:</span>
                    <input id="nowLawS" name="nowLawS" type="text"/>
				</div>
				<div class="bottom-content1">
					<span>专利类型:</span>
					<input id="zlType" name="zlType" type="text"/>
				</div>
				<div class="bottom-content">
					<span>IPC主分类:</span>
					<input id="ipcMC" name="ipcMC" type="text"/>
				</div>
				<div class="bottom-content1">
					<span>主分类翻译:</span>
					<input id="ipcMCFy" name="ipcMCFy" type="text"/>
				</div>
				<div class="bottom-content">
					<span>IPC分类:</span>
					<input id="ipc" name="ipc" type="text"/>
				</div>
                <div class="bottom-content1">
					<span>IPC分类翻译:</span>
					<input id="ipcFy" name="ipcFy" type="text"/>
				</div>
				<div class="bottom-content">
					<span>国民经济分类:</span>
					<input id="cpec" name="cpec" type="text"/>
				</div>
                <div class="bottom-content1">
					<span>国民经济分类翻译:</span>
					<input id="cpecFy" name="cpecFy" type="text"/>
				</div>
				<div class="bottom-content">
					<span>被引证次数:</span>
					<input id="beUsedNum" name="beUsedNum" type="text"/>
				</div>
                <div class="bottom-content1">
					<span>价值度:</span>
					<input id="value" name="value" type="text"/>
				</div>
				<div class="bottom-content">
					<span>密级:</span>
					<input id="secret" name="secret" type="text"/>
				</div>
				<div class="bottom-content3">
					<span>专利附图:</span>
                    <div id="addImage">
                    </div>
                    <div>
                        <input type="button" class="fileinput-button" id="zlImage">
                    </div>
				</div>
                <div class="bottom-content3">
					<span>专利全文:</span>
                    <div id="addText">
                    </div>
                    <div>
                        <input type="button" class="fileinput-button" id="zlText">
                    </div>
				</div>
				<div class="bottom-content3">
					<span>首页附图:</span>
                    <div id="addHomeImage">
                    </div>
                    <div>
                        <input type="button" class="fileinput-button" id="homeImage">
                    </div>
                </div>
				<div class="bottom-submit">
				<button onclick="choose()"><span>提交</span></button>
				</div>
            </form>
        </div>
    </div>
    <input type="hidden" id="pdfurl" >
    <input type="hidden" id="imageurl" >
    <input type="hidden" id="zlFile" >
    <input type="hidden" id="id" name="id">
	<script>
        var pro = window.location.protocol;
        var host = window.location.host;
        var domain = pro + "//" + host;

        layui.use(['layer','upload','laydate'], function() {
            var layer = layui.layer;
            var laydate = layui.laydate;
            var upload = layui.upload;
            var upload1 = layui.upload;
            var upload2 = layui.upload;

            laydate.render({
                elem: '#openDay'
            });
            laydate.render({
                elem: '#applyDay'
            });

            upload.render({
                elem: '#zlImage' //绑定元素
                ,accept: 'file' //允许上传的文件类型
                ,exts: 'zip' //上传后缀
                ,url: '/files/upZip' //上传接口
                ,done: function(res, index, upload){
                    $("#addImage").html('');
                    var allUrl = '';
                    if (res != null) {
                        for (var i = 0; i < res.length; i++) {
                            var fileInfo = res[i];
                            if (i == 0) {
                                allUrl = fileInfo.url;
                            }else {
                                allUrl =  allUrl +';'+ fileInfo.url;
                            }
                            $("#addImage").append('<img src="'+domain+'/statics'+fileInfo.url+'" alt="" class="patentEgImg"/>');
                        }
                    }
                    $("#zlFile").val(allUrl);
                }
            });

            upload1.render({
                elem: '#zlText' //绑定元素
                ,accept: 'file' //允许上传的文件类型
                ,url: '/files' //上传接口
                ,exts: 'pdf' //上传后缀
                ,done: function(res, index, upload){
                    var a = "<a href='"+domain+"/statics"+res.url+"' style='margin-top: 80px;font-size:18px'>点击查看上传文件！</a>";
                    $("#addText").html(a);
                    $("#pdfurl").val(res.url);
                }
            });

            upload2.render({
                elem: '#homeImage' //绑定元素
                ,accept: 'image' //允许上传的文件类型
                ,url: '/files' //上传接口
                ,done: function(res, index, upload){
                    $("#addHomeImage").html('<img src="'+domain+'/statics'+res.url+'" alt="" class="patentEgImg"/>');
                    $("#imageurl").val(res.url);
                }
            });
        });
        function selectFid(){
            $.ajax({
                type : 'get',
                url : '/zlztClassifyinfos/getClassify',
                async : false,
                success : function (data) {
                    if (data.length > 0) {
                        $("#fId").append("<option value =''> </option>");
                        for (var i = 0; i < data.length; i++) {
                            $("#fId").append("<option value ='" + data[i].id + "'>" + data[i].name + "</option>");
                        }
                    }
                }
            });
        }
        selectFid();
        function selectSid() {
            var fId = $("#fId").val();
            $("#sId").html('');
            if (fId != '' && fId != null) {
                $.ajax({
                    type : 'get',
                    url : '/zlztClassifyinfos/getClassify/'+fId,
                    async : false,
                    success : function(data) {
                        var select = $("#sId");
                        for(var i=0; i<data.length; i++){
                            var d = data[i];
                            var id = d['id'];
                            var name = d['name'];
                            select.append("<option value='"+ id +"'>" +name+"</option>");
                        }
                    }
                });
            }
        }

        var id = getUrlParam("id");
        if (id != '') {
            $.ajax({
                type : 'get',
                url : '/zlztDataDetails/getAllData/'+id,
                async : false,
                success : function(data) {
                    $('#id').val(data.id);
                    $('#fId').val(data.fId);
                    selectSid();
                    $('#sId').val(data.sId);
                    $('#tIdName').val(data.tIdName);
                    $('#cIdName').val(data.cIdName);
                    $('#country').val(data.country);
                    $('#openId').val(data.openId);
                    $('#openDay').val((new Date(data.openDay)).Format("yyyy-MM-dd"));
                    $('#applyId').val(data.applyId);
                    $('#applyDay').val((new Date(data.applyDay)).Format("yyyy-MM-dd"));
                    $('#title').val(data.title);
                    $('#titleFy').val(data.titleFy);
                    $('#zy').val(data.zy);
                    $('#zyFy').val(data.zyFy);
                    $('#powerAsk').val(data.powerAsk);
                    $('#powerAFy').val(data.powerAFy);
                    $('#powerAN').val(data.powerAN);
                    $('#applyMan').val(data.applyMan);
                    $('#applyPlace').val(data.applyPlace);
                    $('#createMan').val(data.createMan);
                    $('#lawS').val(data.lawS);
                    $('#nowLawS').val(data.nowLawS);
                    $('#zlType').val(data.zlType);
                    $('#ipcMC').val(data.ipcMC);
                    $('#ipcMCFy').val(data.ipcMCFy);
                    $('#ipc').val(data.ipc);
                    $('#ipcFy').val(data.ipcFy);
                    $('#cpec').val(data.cpec);
                    $('#cpecFy').val(data.cpecFy);
                    $('#beUsedNum').val(data.beUsedNum);
                    $('#value').val(data.value);
                    if (data.homeImage != null && data.homeImage!='') {
                        $("#addHomeImage").html('<img src="'+domain+'/statics'+data.homeImage+'" alt="" class="patentEgImg"/>');
                        $("#imageurl").val(data.homeImage);
                    }
                    if (data.zlText != null && data.zlText!='') {
                        var a = "<a href='"+domain+"/statics"+data.zlText+"' style='margin-top: 80px;font-size:18px'>点击查看上传文件！</a>";
                        $("#addText").html(a);
                        $("#pdfurl").val(data.zlText);
                    }
                    if (data.zlImage != null && data.zlImage!='') {
                        var allUrl = '';
                        if (data.zlImage.indexOf(";") != -1) {
                            var res = data.zlImage.split(";");
                            for (var i = 0; i < res.length; i++) {
                                var fileInfo = res[i];
                                if (i == 0) {
                                    allUrl = fileInfo;
                                }else {
                                    allUrl =  allUrl +';'+ fileInfo;
                                }
                                $("#addImage").append('<img src="'+domain+'/statics'+fileInfo+'" alt="" class="patentEgImg"/>');
                            }
                        }else {
                            $("#addImage").append('<img src="'+domain+'/statics'+data.zlImage+'" alt="" class="patentEgImg"/>');
                            allUrl = data.zlImage;
                        }
                        $("#zlFile").val(allUrl);
                    }
                    $('#createTime').val(data.createTime);
                    $('#updateTime').val(data.updateTime);
                }
            });
        }

        function choose() {
            if (id != '') {
                update();
            }else {
                add();
            }
        }
        function add() {
            var formdata = $("#add_form").serializeObject();
            var secret = $("#secret").val();
            if (secret == 'secret'){
                formdata.secret = secret;
            }
            formdata.fId = $("#fId").val();
            formdata.sId = $("#sId").val();
            formdata.zlImage = $("#zlFile").val();
            formdata.zlText = $("#pdfurl").val();
            formdata.homeImage = $("#imageurl").val();
            formdata.openDay = (new Date($("#openDay").val())).Format("yyyy-MM-dd");
            formdata.applyDay = (new Date($("#applyDay").val())).Format("yyyy-MM-dd");
            console.log(JSON.stringify(formdata));

            $.ajax({
                type : 'post',
                url : '/zlztDataDetails/danjiSave',
                contentType: "application/json; charset=utf-8",
                data : JSON.stringify(formdata),
                success : function(data) {
                    layer.msg("添加成功", {shift: -1, time: 1000}, function(){
                        location.href = "putong.html";
                    });
                }
            });
        }
        function update() {
            var formdata = $("#add_form").serializeObject();
            var secret = $("#secret").val();
            if (secret == 'secret'){
                formdata.secret = secret;
            }
            formdata.id = $("#id").val();
            formdata.fId = $("#fId").val();
            formdata.sId = $("#sId").val();
            formdata.zlImage = $("#zlFile").val();
            formdata.zlText = $("#pdfurl").val();
            formdata.homeImage = $("#imageurl").val();
            formdata.openDay = (new Date($("#openDay").val())).Format("yyyy-MM-dd");
            formdata.applyDay = (new Date($("#applyDay").val())).Format("yyyy-MM-dd");
            console.log(JSON.stringify(formdata));

            $.ajax({
                type : 'put',
                url : '/zlztDataDetails/danjiUpdate',
                contentType: "application/json; charset=utf-8",
                data : JSON.stringify(formdata),
                success : function(data) {
                    layer.msg("修改成功", {shift: -1, time: 1000}, function(){
                        location.href = "putong.html";
                    });
                }
            });
        }
	</script>
</body>

</html>